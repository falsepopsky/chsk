import { ArgsTable, Canvas, Meta, Source, Story } from '@storybook/addon-docs'
import { Axis, Legend } from '@chask/core'
import { Scatter, ScatterPoints } from '../../src'
import { ChartWithLegendSpaceDecorator, dataBubbles } from './decorators'
import dataPolynomials from './dataPolynomials.json'

# Scatter

<Meta title="Addons/XY/Scatter" />
export const Template = args => <Scatter {...args} />

`Scatter` sets up a view for a scatter plot.

<ArgsTable of={Scatter} />

`Scatter` is an organizational component and it does not actually draw any visual elements. However, it manages data representations that can be visualized with other components, for example `ScatterPoints` or `ScatterCurve`.

## Data

Data should be prepared as an array of objects. All objects should contain a string identifier `'id'` and an object called `data` that itself consists of an array of records. The records in the `data` array will constitute the individual data points for plotting.

The pseudocode below demonstrates the required format.

<Source
    language="javascript"
    code={`
[
  {
    "id": "alpha",
    "data": [
      {
        "a": 1,
        "b": 2,
        "c": 3
      },
      {
        "a": 2,
        "b": 4,
        "c": 6
      }
    ]
  },
  ...
]
`}
/>

The above dataset has a series identifier `alpha` - points associated with this identifier will be drawn in the same color.

The nested data array consists of two records with three keys each (`a`, `b`, and `c`). Two of these keys can be selected to display on the x- and y-axes of a scatter chart.

## Axis scaling

`Scatter` can set up x- and y-axes according to manual specifications, or determine relevant settings based on data. To demonstrate this, the examples below use `Scatter` (which doesn't create any visual elements) together with components that visualize axes and an example dataset.

When the scales on the axes are determined automatically, `Scatter` will automatically adjust the scales when the data changes, for example when certain data series are toggled via a legend (example below, left). The automatic rescaling can be disabled via prop `autoRescale` (example below, right).

export const PointsAndLegend = ({ title = 'Polynomials' }) => {
    return (
        <>
            <Axis variant={'bottom'} label={'x (a.u.)'} />
            <Axis variant={'left'} label={'y (a.u.)'} />
            <ScatterPoints />
            <Legend position={[220, 60]} anchor={[0, 0.5]} units={'absolute'} title={title} />
        </>
    )
}

<Canvas>
    <Story
        name="auto-rescaling"
        args={{
            data: dataPolynomials,
            x: 'x',
            y: 'y',
            r: 5,
            scaleX: {
                variant: 'linear',
                domain: [0, 'auto'],
            },
            scaleY: {
                variant: 'linear',
                domain: [0, 'auto'],
            },
            autoRescale: true,
            children: <PointsAndLegend />,
        }}
        component={Scatter}
        decorators={[ChartWithLegendSpaceDecorator]}
    >
        {Template.bind({})}
    </Story>
    <Story
        name="fixed scales"
        args={{
            data: dataPolynomials,
            x: 'x',
            y: 'y',
            r: 5,
            scaleX: {
                variant: 'linear',
                domain: [0, 'auto'],
            },
            scaleY: {
                variant: 'linear',
                domain: [0, 'auto'],
            },
            autoRescale: false,
            children: <PointsAndLegend />,
        }}
        component={Scatter}
        decorators={[ChartWithLegendSpaceDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

## Symbol size

The size of the data points is controlled through prop `r`. This prop is a function, or a key string, that extracts information about each point's radius/size from the raw data.

<Canvas>
    <Story
        name="bubble size"
        args={{
            data: dataBubbles,
            x: 'x',
            y: 'y',
            r: 'r',
            scaleX: {
                variant: 'linear',
                domain: [0, 'auto'],
            },
            scaleY: {
                variant: 'linear',
                domain: [0, 'auto'],
            },
            autoRescale: true,
            children: <PointsAndLegend title={'Series'} />,
        }}
        component={Scatter}
        decorators={[ChartWithLegendSpaceDecorator]}
    >
        {Template.bind({})}
    </Story>
</Canvas>

Note that the output from this function / data key is interpreted as a radius, not a symbol area.
